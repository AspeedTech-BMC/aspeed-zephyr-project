# OTP Sample

The OTP sample contains the following folder
- config
  A json configuration file for generate OTP image
- key
  OEM DSS key for verifying the first mutable code

## Configuration

The sample configuration is for generating OTP image for MP.  
Please note that **DO NOT** put vault key in the configuration, besides, `ecc_region` **MUST BE** `false`. It is because preloaded-firmware still need to update OTP data region during bootup and the vault key should be generated by AST1060 true random number generator for meeting DICE requirement.

```json
"data_region": {
    // Should be false
    "ecc_region": false,

    "key": [

        // Vault key will be generated by AST1060 trng
        // Should not contain vault key
        //{
        //    "types": "aes_vault",
        //    "key_bin": "test_aes_vault_key.bin",
        //    "key_bin2": "test_aes_vault_key_1.bin",
        //    "offset": "0x40"
        //},

        {
            "types": "ecdsa_pub",
            "key_pem": "rk384_pub.pem",
            "offset": "0x480",
            "number_id": 0
        }
    ]
}
"config_region": {
    "Signature Scheme": "ECDSA384"
}
```

## Key

The sample ECDSA384 key pair for signing/verifying image  

Command for generating signed first mutable firmware:

```
socsec make_secure_bl1_image --soc 1060 --algorithm ECDSA384 --bl1_image ./zephyr.bin --output ./zephyr.signed.bin --ecdsa_sign_key ./otp/key/rk384_prv.pem

```

## Image

Command for generating otp image:

```
$ otptool make_otp_image ./otp/config/1060A2_ECDSA_MP.json --no_last_bit --key_folder ./otp/key/ --output_folder ./otp/image/
```
`--no_last_bit` should be added since preload firmware will generate vault key and append vault key header.
